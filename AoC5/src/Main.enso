from Standard.Base import all
from Standard.Table import all
from Standard.Database import all
from Standard.AWS import all
from Standard.Google_Api import all
from Standard.Snowflake import all
import Standard.Examples
import Standard.Visualization
import local.NewProject7

## ICON group
is_well_ordered any1 node6 =
    node5 = any1.drop 1
    vector3 = any1.zip node5
    any2 = Table.from_rows ["L", "R"] vector3
    table1 = any2.join node6 ..Left_Outer [(..Equals 'L'), (..Equals 'R')]
    any3 = table1.remove_columns (regex "Right.*")
    table2 = any3.fill_nothing ['Good'] True
    node7 = table2.at "Good" . to_vector . all x->x
    node7

## ICON group
find_constrained any6 any8 =
    table2 = any6.join any8 ..Inner [(..Equals 'L' 'Value')]
    any7 = table2.remove_columns ['Value']
    table3 = any8.join any7 join_kind=..Left_Outer [(..Equals 'Value' 'R')]
    node4 = table3.set (expr 'if [R] is null then True else False') "Unconstrained"
    any9 = node4.remove_columns ['L', 'R']
    any9

topo_sort edges vertices =
    go acc_list remaining_vertices =
        if remaining_vertices.row_count == 0 then acc_list else
            t = find_constrained edges remaining_vertices
            v_to_add = t.filter "Unconstrained" ..Is_True . at "Value" . to_vector
            if v_to_add.is_empty then Panic.throw "Cycle"
            new_remaining = t.filter "Unconstrained" ..Is_True . remove_columns "Unconstrained"
            @Tail_Call go acc_list+v_to_add new_remaining
    go [] vertices

main =
    file1 = Data.read 'X:\\NBO\\aoc24\\5-test.txt'
    any3 = Data.read 'X:\\NBO\\aoc24\\5-input.txt'
    vector1 = file1.lines
    integer1 = vector1.index_of ""
    vector2 = vector1.take integer1
    node1 = vector1.drop integer1+1
    node3 = node1.map s-> s.split "," . map Integer.parse
    any1 = node3.at 3
    any5 = vector2.to_table
    table1 = any5.parse_to_columns 'Value' "(?<R>\d+)\|(?<L>\d+)"
    node13 = table1.set False "Good"
    node5 = node3.map (is_well_ordered _ node13)
    vector3 = node3.zip node5
    node8 = vector3.filter p-> p.second
    node9 = node8.map .first
    node10 = node9.map v-> v.at (v.length.div 2)
    any2 = node10.compute ..Sum
    node11 = vector3.filter p-> p.second.not
    node12 = node11.map .first
    any4 = node12.first
    node7 = Main.is_well_ordered any1 node13
    node2 = node13.select_columns ["R", "L"]
    ## swap columns with each other - now we want edges to flow in the original order
    any6 = node2.rename_columns ["L", "R"]
    any8 = any4.to_table
    any9 = Main.find_constrained any6 any8
    any7 = topo_sort any6 any8



#### METADATA ####
[[{"index":{"value":306},"size":{"value":4}},"761d8ea8-cf91-4057-850c-bbf581145253"],[{"index":{"value":311},"size":{"value":5}},"626b0743-3892-43af-8767-09ac04132c6d"],[{"index":{"value":331},"size":{"value":11}},"bc5c1a0b-8668-4ed3-9e91-ec1f4a6e991b"],[{"index":{"value":357},"size":{"value":8}},"1f341f72-7df0-4ba6-8f6c-bfbcaafc8035"],[{"index":{"value":357},"size":{"value":14}},"c68e3255-3b62-4eb5-ab89-669027d65b4e"],[{"index":{"value":383},"size":{"value":15}},"42c51a3a-b80b-4c3d-8d2b-865a1719bc4c"],[{"index":{"value":383},"size":{"value":26}},"899d9236-052c-47b0-9984-dbc140236ec3"],[{"index":{"value":383},"size":{"value":34}},"1d965093-ab4b-408b-bc72-becf7346708f"],[{"index":{"value":431},"size":{"value":9}},"3de5533e-7d19-4546-9e4a-2cff38942664"],[{"index":{"value":431},"size":{"value":15}},"051058ab-7e85-41f9-b92f-a30083069788"],[{"index":{"value":431},"size":{"value":28}},"0bb125e7-e7d1-476a-a3e2-9a28e0b2d9d9"],[{"index":{"value":431},"size":{"value":61}},"551444c1-9fc0-47fd-b5b2-decaaff1b458"],[{"index":{"value":504},"size":{"value":39}},"ace9375c-8b3f-4021-a18c-e413abbfd2ab"],[{"index":{"value":557},"size":{"value":17}},"8e3e56d0-a80a-4583-a97a-fccabb31c1b7"],[{"index":{"value":557},"size":{"value":26}},"acecdb09-640a-4792-93d1-fb9114b2c9bc"],[{"index":{"value":557},"size":{"value":31}},"27704c8c-74eb-40ce-bc70-0e4191e19fe2"],[{"index":{"value":601},"size":{"value":39}},"bca53f02-09b9-4575-8f36-65d40ea19c81"],[{"index":{"value":645},"size":{"value":5}},"9eeb2eff-8976-4887-8912-c53c82649bb4"],[{"index":{"value":708},"size":{"value":9}},"3bb155ae-3df7-401c-adb4-fc707196bbf1"],[{"index":{"value":708},"size":{"value":14}},"5b26dd4e-205c-406d-a36a-edfb4256b170"],[{"index":{"value":708},"size":{"value":22}},"70248c79-818e-45d7-90f9-ea5dbbe17661"],[{"index":{"value":708},"size":{"value":47}},"b75d186e-b24e-468e-998f-88ba01d92f21"],[{"index":{"value":767},"size":{"value":21}},"93f477d2-2383-4a28-a174-201c37ea7d47"],[{"index":{"value":767},"size":{"value":31}},"eab25457-82bf-4998-9332-1529890e81c5"],[{"index":{"value":812},"size":{"value":9}},"90fe61c6-60f4-453a-b767-d95919f7bf1d"],[{"index":{"value":812},"size":{"value":14}},"8a092360-c9cb-44b8-a08e-c403fd8d2916"],[{"index":{"value":812},"size":{"value":37}},"185aa252-5656-4a11-afcf-67c5cee73b77"],[{"index":{"value":812},"size":{"value":62}},"ed433875-a4a3-4adf-800b-5f21e8e47c24"],[{"index":{"value":887},"size":{"value":71}},"a62c69c2-d064-4196-8fa3-ccc1b6f2e337"],[{"index":{"value":970},"size":{"value":20}},"e7bb01f3-c7cb-43ce-9753-700e339ba531"],[{"index":{"value":970},"size":{"value":31}},"337a263e-cd67-41d3-a83d-d7a0abc1b17f"],[{"index":{"value":1006},"size":{"value":4}},"726380cc-bf9e-4220-84b4-c2222e9a8603"],[{"index":{"value":1532},"size":{"value":38}},"fcf199e6-d2b1-44b7-be92-a47545d6a593"],[{"index":{"value":1582},"size":{"value":9}},"5a0d7f34-727d-487f-bc19-e0001125e723"],[{"index":{"value":1582},"size":{"value":39}},"96b1ecfc-8249-4125-9ef0-38fdd1736ebb"],[{"index":{"value":1636},"size":{"value":11}},"aaf7ce37-ff6f-476b-b18a-3074cd1a03b4"],[{"index":{"value":1663},"size":{"value":19}},"152c8f31-2b50-421e-99f8-3b303251e07a"],[{"index":{"value":1697},"size":{"value":12}},"757f8a95-273d-4b30-833f-40dbd7cae8b2"],[{"index":{"value":1697},"size":{"value":21}},"13fa66db-5e8e-4e33-a74f-2f0b1f8767b8"],[{"index":{"value":1731},"size":{"value":23}},"fc0b72c7-e883-4ad5-bebc-f3dbc2e0d6bd"],[{"index":{"value":1767},"size":{"value":45}},"0adaebe2-fb94-44dd-84c8-368ea6e64278"],[{"index":{"value":1824},"size":{"value":8}},"66779e83-c5d7-41d3-8714-08f83b21e961"],[{"index":{"value":1824},"size":{"value":10}},"f3a020aa-3454-4b06-ab91-b9e8352e2ad4"],[{"index":{"value":1846},"size":{"value":16}},"15ff4933-bdd5-46b2-a6a0-feee440769c3"],[{"index":{"value":1876},"size":{"value":21}},"078d2385-7a36-4b09-a6a2-2753e116f19f"],[{"index":{"value":1876},"size":{"value":29}},"cc467354-eb19-494f-bab2-a78e2952c965"],[{"index":{"value":1876},"size":{"value":52}},"bea78058-a832-43a0-a0af-fa9b4286f700"],[{"index":{"value":1942},"size":{"value":23}},"28f42dd1-48f1-4215-9e47-b06968b3f476"],[{"index":{"value":1978},"size":{"value":36}},"24299439-3169-4ffd-a39d-eb97dbf0213d"],[{"index":{"value":2029},"size":{"value":9}},"1a6f9566-0e53-4b41-a306-450586339c13"],[{"index":{"value":2029},"size":{"value":15}},"8bd1923b-d9ee-4d53-81fb-ca343b1e7ead"],[{"index":{"value":2057},"size":{"value":27}},"82a51b8d-8f08-44de-b50b-02e59f43fa1a"],[{"index":{"value":2097},"size":{"value":16}},"44c5be95-60d8-479d-8df7-46928871066b"],[{"index":{"value":2127},"size":{"value":35}},"2f5c9cf9-4b34-48d8-b4e8-e1fe6f3eeb62"],[{"index":{"value":2174},"size":{"value":14}},"defc6610-6623-4166-aa01-f447735d2222"],[{"index":{"value":2174},"size":{"value":20}},"249d7804-c7d4-4d23-b407-e273da02387b"],[{"index":{"value":2208},"size":{"value":31}},"510e207a-4e6e-417c-81b8-96d7c2b1b23c"],[{"index":{"value":2253},"size":{"value":17}},"92cedebe-e2d3-4f18-8038-e86684aa68b4"],[{"index":{"value":2282},"size":{"value":12}},"2c8ab64b-792a-4f2e-ad7a-dab4a606ade1"],[{"index":{"value":2307},"size":{"value":32}},"277b3412-74af-45b3-9c5e-e6ce13f866c7"],[{"index":{"value":2352},"size":{"value":32}},"4ad4ca45-79dc-475d-a02a-79fdcf549ebc"],[{"index":{"value":2482},"size":{"value":31}},"7444c3e4-cb90-4492-84f4-f0ace71184af"],[{"index":{"value":2525},"size":{"value":13}},"e05bf7a4-143c-4a3e-9fb8-ab8154cbdf5f"],[{"index":{"value":2550},"size":{"value":31}},"916099d0-0730-4dda-814e-b840b5386551"],[{"index":{"value":2593},"size":{"value":19}},"b43b6730-0ab7-4b8b-9e2a-d80bd09d9e89"]]
{"ide":{"node":{"761d8ea8-cf91-4057-850c-bbf581145253":{"position":{"vector":[-839,14]}},"626b0743-3892-43af-8767-09ac04132c6d":{"position":{"vector":[-839,58]}},"bc5c1a0b-8668-4ed3-9e91-ec1f4a6e991b":{"position":{"vector":[-519,-58]},"visualization":{"show":false,"width":265.60009765625,"height":250.79998779296875}},"c68e3255-3b62-4eb5-ab89-669027d65b4e":{"position":{"vector":[-609,-97]}},"1f341f72-7df0-4ba6-8f6c-bfbcaafc8035":{"position":{"vector":[-655,-422]}},"1d965093-ab4b-408b-bc72-becf7346708f":{"position":{"vector":[-820,-130]},"visualization":{"show":false,"width":441.362548828125,"height":230}},"899d9236-052c-47b0-9984-dbc140236ec3":{"position":{"vector":[-741,-498]}},"42c51a3a-b80b-4c3d-8d2b-865a1719bc4c":{"position":{"vector":[-714,-469]}},"551444c1-9fc0-47fd-b5b2-decaaff1b458":{"position":{"vector":[-839,-176]},"visualization":{"show":false,"width":835.8780517578125,"height":253.199951171875}},"0bb125e7-e7d1-476a-a3e2-9a28e0b2d9d9":{"position":{"vector":[-741,-802]}},"051058ab-7e85-41f9-b92f-a30083069788":{"position":{"vector":[-741,-802]}},"3de5533e-7d19-4546-9e4a-2cff38942664":{"position":{"vector":[-741,-802]}},"ace9375c-8b3f-4021-a18c-e413abbfd2ab":{"position":{"vector":[-839,-223]}},"27704c8c-74eb-40ce-bc70-0e4191e19fe2":{"position":{"vector":[-839,-266]},"visualization":{"show":true,"width":333.7625732421875,"height":209.20001220703125}},"acecdb09-640a-4792-93d1-fb9114b2c9bc":{"position":{"vector":[-807,-868]}},"8e3e56d0-a80a-4583-a97a-fccabb31c1b7":{"position":{"vector":[-807,-868]}},"bca53f02-09b9-4575-8f36-65d40ea19c81":{"position":{"vector":[-418,-266]},"visualization":{"show":true}},"9eeb2eff-8976-4887-8912-c53c82649bb4":{"position":{"vector":[-418,-547]}},"b75d186e-b24e-468e-998f-88ba01d92f21":{"position":{"vector":[-1149,-808]},"visualization":{"show":false,"height":372.39996337890625}},"70248c79-818e-45d7-90f9-ea5dbbe17661":{"position":{"vector":[-1096,-834]}},"5b26dd4e-205c-406d-a36a-edfb4256b170":{"position":{"vector":[-1059,-879]}},"3bb155ae-3df7-401c-adb4-fc707196bbf1":{"position":{"vector":[-1059,-879]}},"eab25457-82bf-4998-9332-1529890e81c5":{"position":{"vector":[-1149,-848]}},"93f477d2-2383-4a28-a174-201c37ea7d47":{"position":{"vector":[-1056,-895]}},"ed433875-a4a3-4adf-800b-5f21e8e47c24":{"position":{"vector":[-1204,-898]},"visualization":{"show":false,"height":354}},"185aa252-5656-4a11-afcf-67c5cee73b77":{"position":{"vector":[-1146,-949]}},"8a092360-c9cb-44b8-a08e-c403fd8d2916":{"position":{"vector":[-1146,-949]}},"90fe61c6-60f4-453a-b767-d95919f7bf1d":{"position":{"vector":[-1146,-949]}},"a62c69c2-d064-4196-8fa3-ccc1b6f2e337":{"position":{"vector":[-1204,-953]},"visualization":{"show":false,"width":685.96240234375,"height":247.5999755859375}},"337a263e-cd67-41d3-a83d-d7a0abc1b17f":{"position":{"vector":[-1204,-993]},"visualization":{"show":true,"width":705.05615234375,"height":365.20001220703125}},"e7bb01f3-c7cb-43ce-9753-700e339ba531":{"position":{"vector":[-1137,-1017]}},"726380cc-bf9e-4220-84b4-c2222e9a8603":{"position":{"vector":[-1204,-1431]}},"fcf199e6-d2b1-44b7-be92-a47545d6a593":{"position":{"vector":[-695,288]},"visualization":{"show":false,"width":1027.671875,"height":193}},"96b1ecfc-8249-4125-9ef0-38fdd1736ebb":{"position":{"vector":[-316,288]}},"5a0d7f34-727d-487f-bc19-e0001125e723":{"position":{"vector":[-233,258]}},"aaf7ce37-ff6f-476b-b18a-3074cd1a03b4":{"position":{"vector":[-741,216]},"visualization":{"show":false,"width":523.2000122070312,"height":503.6000061035156}},"152c8f31-2b50-421e-99f8-3b303251e07a":{"position":{"vector":[-603,171]}},"13fa66db-5e8e-4e33-a74f-2f0b1f8767b8":{"position":{"vector":[-923,119]}},"757f8a95-273d-4b30-833f-40dbd7cae8b2":{"position":{"vector":[-797,108]}},"fc0b72c7-e883-4ad5-bebc-f3dbc2e0d6bd":{"position":{"vector":[-649,119]}},"0adaebe2-fb94-44dd-84c8-368ea6e64278":{"position":{"vector":[-717,68]},"visualization":{"show":false,"width":625.5438232421875,"height":240.4000244140625}},"f3a020aa-3454-4b06-ab91-b9e8352e2ad4":{"position":{"vector":[-717,14]},"visualization":{"show":false,"width":268.79998779296875,"height":334}},"66779e83-c5d7-41d3-8714-08f83b21e961":{"position":{"vector":[-741,-25]},"visualization":{"show":true,"width":268.79998779296875,"height":334}},"15ff4933-bdd5-46b2-a6a0-feee440769c3":{"position":{"vector":[-1416,73]}},"bea78058-a832-43a0-a0af-fa9b4286f700":{"position":{"vector":[-1436,33]}},"cc467354-eb19-494f-bab2-a78e2952c965":{"position":{"vector":[-1416,33]}},"078d2385-7a36-4b09-a6a2-2753e116f19f":{"position":{"vector":[-1416,33]}},"28f42dd1-48f1-4215-9e47-b06968b3f476":{"position":{"vector":[-1416,-9]},"visualization":{"show":true,"width":414.92498779296875,"height":214.00003051757812}},"24299439-3169-4ffd-a39d-eb97dbf0213d":{"position":{"vector":[-511,-9]},"visualization":{"show":true,"width":587.034423828125,"height":274.79998779296875}},"8bd1923b-d9ee-4d53-81fb-ca343b1e7ead":{"position":{"vector":[-830,-334]}},"1a6f9566-0e53-4b41-a306-450586339c13":{"position":{"vector":[-747,-413]}},"82a51b8d-8f08-44de-b50b-02e59f43fa1a":{"position":{"vector":[-973,-406]},"visualization":{"show":true,"width":461.0374755859375,"height":176.4000244140625}},"44c5be95-60d8-479d-8df7-46928871066b":{"position":{"vector":[-476,-356]},"visualization":{"show":false,"width":603.1875,"height":184.4000244140625}},"2f5c9cf9-4b34-48d8-b4e8-e1fe6f3eeb62":{"position":{"vector":[-395,-406]},"visualization":{"show":true,"height":166.79998779296875}},"249d7804-c7d4-4d23-b407-e273da02387b":{"position":{"vector":[84,-356]},"visualization":{"show":true}},"defc6610-6623-4166-aa01-f447735d2222":{"position":{"vector":[-272,-654]}},"510e207a-4e6e-417c-81b8-96d7c2b1b23c":{"position":{"vector":[-1682,-406]},"visualization":{"show":true,"width":400.85072157118054,"height":190}},"92cedebe-e2d3-4f18-8038-e86684aa68b4":{"position":{"vector":[-1650,-645]}},"2c8ab64b-792a-4f2e-ad7a-dab4a606ade1":{"position":{"vector":[-1632,-684]},"visualization":{"show":false,"width":304.888916015625,"height":339.3332926432292}},"277b3412-74af-45b3-9c5e-e6ce13f866c7":{"position":{"vector":[-880,-73]},"visualization":{"show":true}},"4ad4ca45-79dc-475d-a02a-79fdcf549ebc":{"position":{"vector":[-1149,-654]}},"7444c3e4-cb90-4492-84f4-f0ace71184af":{"position":{"vector":[-1149,-717]},"visualization":{"show":false,"width":584.6909993489583,"height":417.5555419921875}},"e05bf7a4-143c-4a3e-9fb8-ab8154cbdf5f":{"position":{"vector":[-1579,-726]},"visualization":{"show":true,"width":235.20001220703125,"height":226.79998779296875}},"916099d0-0730-4dda-814e-b840b5386551":{"position":{"vector":[-1265,-812]},"visualization":{"show":true,"width":593.6812133789062,"height":349.20001220703125}},"b43b6730-0ab7-4b8b-9e2a-d80bd09d9e89":{"position":{"vector":[-1733,-1044]},"visualization":{"show":true,"width":337.5999755859375,"height":276.39996337890625}}},"widget":{},"snapshot":"eJyNVltv2zYUfvevOFAeZC8xUdu5DnW6Nu2KAF5SOFk3wDYIVqJkthSpkZTlFP3xBUlJluwmmB4MWuf+ncPvKFEygwdDRExUjN4RTYFluVQGCOe9pCN9JF/4C+L3xJAvLzp4+8/D88KPUqac4rc5e17nQcgy4eRbJ0Z1bJQ+bEmWc6oPBJ+ZLghn34lhUtRSLiPC0R0tPyn5lUbmotc7OoLbm/s7SJUs8h7TuKScY6liqmgMRDyNQMiYnsO0BwDufAZTJ0CxkjmM3PsNjYxUk1ryneVe1QmJeBrDFBykyBaJlSw1LIJZcALBPFjV5k7bWLWR9zRGXyUTVQYIzWhi8H1hqIJFH6EP/xWEawhn4eAEWv/n4WBVB7YpeY9I0UxuKI4kLzKhoa9oSrcQzFm6Nui3YLCLPvbRJyhhnGMhzZqJFBbhRynjcAWPqqANGhd1gDEiBgKrEgACI7EvCpBtHGyH19udzT7uCRMxjqTQRhEmPPDn9ueywr2d1rkHxUkRuhXiAA4IPxNe0BYMrSz3YFhUuqtdnKqNl02cC7An/I2JePpsF7ybFvq20tM67gRpaqBPt7mCkCWwmK+AaRAF52DWVDhQgXJN4U/CNQ0HEPwtWpAEdSlXMPWuDyuZhSc2flP1Va9nZC6xtsNP45Rq2FBlWER1hWsqgUQR5kwbUDQjTDCR4j0l+7DkF3KkZIkjWQgD0ym88oU0/mwxjb0DF6Zw0Gmf1qHvjuUGG4lJHFs07VBa7PfgsaOgsUMRgZ1E14/OKHZcsqTxipjGNMvNky/gExEsQmatZAnBzVPEadCxFLTETb7/N6O9Xv2qt/XzxyNhHN/YW9Nqz3GDQSd+3cXFqmltr2dlVe8S5snEEjZSlMQQ/vv7cnn37n65JDIany6XZ0NDtUFma8I2a7xowURetEw8viPXX0s1nImqg0wYmlInqpQQEzHdYplAELSMxy0N41i/smzuUtuHo95a43inM6kuxwhlJAc9vAaNdM6ZgeDEzoJ9e+vNUE5UNaCO5r3hxLLYpH571oQcIyOxu8kHJH3mPdn21O2tySDov3k9v17Gx4Plj/6b1zN3DHYVtdjZ0oO7+RWHdtaNz8wm399fUbjyNNjbQ96ku4js6bIpaVLPbT68hhxpGkkRN3o1zVy6sChhSptd4q8q6ZWTbobXsLHA9TeIU5GaNYrZBsaD9vrzdiiSWV4YCgg9FNnO4ejltJCQreiNu9F+ckQ8ndbC8V7Sdgf8RZhAz2750aRRbkJY4uY0MjuaDeZ2bc8CT7NHR6BLkkMtLplZAyXRGqRZUwVDELKEkkJJRE3CRkLCZQlMWMYBqVjKBOHgEqrrOK8ysBtLkKzF8813Q6166QfxtDuj1a5wJT+/YDsbslkWO/FP2A85wA=="}}
